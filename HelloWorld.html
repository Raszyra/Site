<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hello, World! Full Game</title>
<style>
/* --- BODY & LAYOUT --- */
body { font-family: 'Fira Code', monospace; background: #1e1e2f; color: #eee; margin: 0; padding: 20px; }
h1, h2, h3 { color: #0ff; margin: 5px 0; }
#game { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
.deck, .player-area, .playarea, .cardinfo, .setup, .console { border-radius: 8px; padding: 10px; background: #2a2a3d; min-width: 220px; }
.card { margin: 5px; padding: 5px 10px; border-radius: 5px; cursor: pointer; display:inline-block; transition: 0.2s; }
.card:hover { transform: translateY(-3px); box-shadow: 0 2px 5px #0ff; }
.selected { border: 2px solid #0f0; }
.Variable { background: #1e90ff; color: #fff; }
.Function { background: #ff4c4c; color: #fff; }
.Loop { background: #ffa500; color: #000; }
.Library { background: #32cd32; color: #000; }
.Bonus { background: #ffd700; color: #000; }
.Bug { background: #333; color: #fff; }
.Event { background: #0ff; color: #000; }
.IfElse { background: #a020f0; color: #fff; }
.console { max-height: 200px; overflow-y: auto; background: #111; color: #0f0; font-family: monospace; margin-top: 10px; }
.ruleset { position: fixed; bottom: 0; left: 0; right: 0; max-height: 220px; overflow-y: auto; background: #111; border-top: 2px solid #0ff; padding: 10px; }
.ruleset h3 { cursor: pointer; }
.hidden { display: none; }
button { margin: 3px; padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; background: #0ff; color: #111; transition: 0.2s; }
button:hover { background: #0aa; }
</style>
</head>
<body>
<h1>Hello, World! Full Game</h1>

<div class="setup">
<h3>New Game</h3>
Players: <input type="number" id="numPlayers" min="2" value="3"><br>
Game Size: <select id="gameSize">
  <option value="quick">Quick Game</option>
  <option value="full" selected>Full Game</option>
</select><br>
<button id="newGameBtn">Start Game</button>
</div>

<div id="game" style="display:none;">
  <div class="deck">
    <h3>Main Deck</h3>
    <button id="drawMainBtn">Draw from Main Deck</button>
    <div id="deckCount"></div>
  </div>

  <div class="playarea">
    <h3>Program Area</h3>
    <div id="programArea"></div>
    <button id="playCardBtn">Play Selected Card</button>
    <button id="completeProgramBtn">Finish Program</button>
    <button id="passBtn">Pass Turn</button>
    <button id="drawLangBtn">Draw from Language Deck</button>
  </div>

  <div id="players"></div>

  <div class="cardinfo">
    <h3>Card Info</h3>
    <div id="cardInfoText">Select a card to see details.</div>
  </div>

  <div class="console">
    <h3>Console Log</h3>
    <div id="consoleLog"></div>
  </div>
</div>

<div class="ruleset">
<h3 id="toggleRules">Ruleset (click to collapse)</h3>
<div id="rulesContent">
<p>
- Start with 8 cards in hand.<br>
- One card played, one card drawn per turn.<br>
- Variables go inside Functions; Functions can nest inside Loops or other Functions.<br>
- Must have required Variables and Libraries to complete a Function.<br>
- If/Else cards chain Functions for extra points.<br>
- Bonuses add extra points.<br>
- First to 1 program (Quick) or 3 programs (Full) wins.<br>
</p>
</div>
</div>

<script>
// --- Game Variables ---
let NUM_PLAYERS = 3;
let PROGRAMS_TO_WIN = 3;
const MAX_HAND = 8;
let currentPlayer = 0;
let mainDeck = [];
let players = [];
let selectedCardIndex = null;
let selectedFunctionIndex = null;

// --- Logger ---
function logAction(msg){
  const log=document.getElementById('consoleLog');
  const entry=document.createElement('div');
  entry.textContent=`> ${msg}`;
  log.appendChild(entry);
  log.scrollTop=log.scrollHeight;
}

// --- Card Creation ---
function createCard(type,name,value=0,desc="",reqVars=[],reqLibs=[],difficulty=1){ 
  return {type,name,value,desc,variables:[],reqVars,reqLibs,difficulty}; 
}

// --- Sample Cards (For brevity, a minimal demo set) ---
const allCards = [];
// Variables
['Integer','Boolean','String','Media','Class','Button'].forEach((v,i)=>allCards.push(createCard('Variable',v+' '+(i+1),i+1,v+' variable')));
// Functions
allCards.push(createCard('Function','Assign',0,'Assign a variable',['any'],[],1));
allCards.push(createCard('Function','Add',0,'Add two integers',['Integer','Integer'],[],1));
allCards.push(createCard('Function','Calculator',0,'2 Integers + IOStream',['Integer','Integer'],['IOstream'],1));
allCards.push(createCard('Function','Print',0,'Print 1 String',['String'],['IOstream'],1));
// Libraries
allCards.push(createCard('Library','IOstream',5,'C++ IO library'));
allCards.push(createCard('Library','Vector',5,'C++ Vector library'));

// --- Shuffle ---
function shuffle(deck){ for(let i=deck.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }}

// --- Rendering ---
function renderPlayers(){
  const container=document.getElementById('players');
  container.innerHTML='';
  players.forEach((p,idx)=>{
    const div=document.createElement('div');
    div.className='player-area';
    div.innerHTML=`<h3>${p.name} ${idx===currentPlayer?'(Current)':''}</h3>
      <strong>Score:</strong> ${p.score}<br>
      <strong>Hand:</strong><div id="hand-${idx}"></div>
      <strong>Language Deck:</strong> <div id="langDeckCount-${idx}">${p.langDeck.length} cards</div>`;
    container.appendChild(div);
    renderHand(idx);
  });
}

function renderHand(idx){
  const handDiv=document.getElementById(`hand-${idx}`);
  handDiv.innerHTML='';
  players[idx].hand.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}${i===selectedCardIndex?' selected':''}`;
    cDiv.textContent=c.name;
    cDiv.onclick=()=>{ selectedCardIndex=i; renderHand(idx); showCardInfo(c); };
    handDiv.appendChild(cDiv);
  });
}

function renderProgram(){
  const div=document.getElementById('programArea'); div.innerHTML='';
  const p=players[currentPlayer];
  p.program.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}${i===selectedFunctionIndex?' selected':''}`;
    cDiv.textContent=c.name+' (Score:'+calculateFunctionScore(c)+')';
    div.appendChild(cDiv);
  });
}

function showCardInfo(card){ 
  document.getElementById('cardInfoText').textContent=`${card.name} (${card.type}): ${card.desc}`; 
}

// --- Score check ---
function calculateFunctionScore(func){
  let score=0;
  if(func.type!=='Function') return 0;
  func.variables.forEach(v=>score+=v.value);
  if(func.reqLibs && func.reqLibs.length>0) score+=func.reqLibs.length*2;
  score*=func.difficulty;
  return score;
}

// --- Actions ---
document.getElementById('drawMainBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(mainDeck.length===0) return alert('Main deck empty!');
  const card=mainDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Main Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderDeck();
};

document.getElementById('drawLangBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(p.langDeck.length===0) return alert('Language deck empty!');
  const card=p.langDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Language Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderPlayers();
};

document.getElementById('playCardBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(selectedCardIndex===null) return;
  const card=p.hand[selectedCardIndex];
  if(card.type==='Variable' && selectedFunctionIndex!==null){
    const func=p.program[selectedFunctionIndex];
    if(func.variables.length>=card.reqVars?.length || func.reqVars.includes(card.type) || func.reqVars.includes('any')){
      func.variables.push(card);
      logAction(`${p.name} assigned ${card.name} to ${func.name}`);
      p.hand.splice(selectedCardIndex,1);
      selectedCardIndex=null;
      renderHand(currentPlayer);
      renderProgram();
      return;
    } else {
      alert('Cannot assign this variable to selected function.');
      return;
    }
  }
  // Place function in program
  if(card.type==='Function' || card.type==='Library'){
    p.program.push(card);
    logAction(`${p.name} played ${card.type}: ${card.name}`);
    p.hand.splice(selectedCardIndex,1);
    selectedCardIndex=null;
    renderHand(currentPlayer);
    renderProgram();
  }
};

document.getElementById('completeProgramBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.program.length===0) return alert('No program built!');
  // check function requirements
  for(const f of p.program){
    if(f.type==='Function'){
      if(f.reqVars.length>f.variables.length) return alert('Function '+f.name+' is incomplete!');
    }
  }
  let score=p.program.reduce((s,c)=>s+calculateFunctionScore(c),0);
  p.score+=score;
  logAction(`${p.name} completed a program worth ${score} points! Total: ${p.score}`);
  p.program=[];
  selectedFunctionIndex=null;
  if(p.score>=PROGRAMS_TO_WIN*10){ // arbitrary scoring threshold
    alert(`${p.name} wins!`);
    document.getElementById('game').style.display='none';
    return;
  }
  nextPlayer();
};

document.getElementById('passBtn').onclick=()=>{
  logAction(`${players[currentPlayer].name} passed their turn.`);
  nextPlayer();
};

function nextPlayer(){
  currentPlayer=(currentPlayer+1)%players.length;
  logAction(`It is now ${players[currentPlayer].name}'s turn.`);
  selectedCardIndex=null;
  renderPlayers();
  renderProgram();
}

// --- New Game ---
document.getElementById('newGameBtn').onclick=()=>{
  NUM_PLAYERS=parseInt(document.getElementById('numPlayers').value);
  const size=document.getElementById('gameSize').value;
  PROGRAMS_TO_WIN=size==='quick'?1:3;
  currentPlayer=0;
  players.length=0;
  mainDeck=allCards.filter(c=>['Variable','Bonus','Bug','Event','IfElse'].includes(c.type));
  shuffle(mainDeck);
  for(let i=0;i<NUM_PLAYERS;i++){
    const langDeck=allCards.filter(c=>['Function','Loop','Library'].includes(c.type));
    shuffle(langDeck);
    const hand=[];
    for(let j=0;j<MAX_HAND;j++){
      hand.push(mainDeck.pop()||langDeck.pop());
    }
    players.push({name:`Player ${i+1}`, hand:hand, programs:[], score:0, program:[], langDeck:langDeck});
  }
  document.getElementById('consoleLog').innerHTML='';
  logAction(`New game started with ${NUM_PLAYERS} players. First to ${PROGRAMS_TO_WIN} programs wins.`);
  document.getElementById('game').style.display='flex';
  renderPlayers();
  renderDeck();
  renderProgram();
};

function renderDeck(){ document.getElementById('deckCount').textContent=`Cards left: ${mainDeck.length}`; }

// --- Rules collapse ---
document.getElementById('toggleRules').onclick=()=>{
  document.getElementById('rulesContent').classList.toggle('hidden');
};
</script>
</body>
</html>
