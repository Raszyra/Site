<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hello, World! Full Game</title>
<style>
body { font-family: Arial; padding: 20px; background: #f0f0f0; margin-bottom: 300px; }
#game { display: flex; flex-wrap: wrap; gap: 20px; }
.deck, .player-area, .playarea, .ruleset, .cardinfo, .setup, .console { border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: #fff; min-width: 220px; }
.card { margin: 5px; padding: 5px; border-radius: 5px; cursor: pointer; display:inline-block; }
.Function { background: #f88; }
.Variable { background: #88f; }
.Loop { background: #f90; }
.Library { background: #8f8; }
.Bonus { background: #ff8; }
.Bug { background: #333; color: #fff; }
.Event { background: #0ff; }
.IfElse { background: #a0a; color: #fff; }
.selected { border: 2px solid gold; }
.ruleset { position: fixed; bottom: 0; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: #fff; }
.console { max-height: 150px; overflow-y: auto; background: #111; color: #0f0; font-family: monospace; }
.requirements { margin-bottom: 10px; }
.requirement-card { margin: 3px; padding: 3px; border-radius: 5px; display:inline-block; color:#fff; }
.requirement-met { background: #4caf50; } /* green */
.requirement-not { background: #f44336; } /* red */
</style>
</head>
<body>
<h1>Hello, World! Full Game</h1>

<div class="setup">
<h3>New Game</h3>
Players: <input type="number" id="numPlayers" min="3" value="3"><br>
Game Size: <select id="gameSize">
  <option value="quick">Quick Game</option>
  <option value="full">Full Game</option>
</select><br>
<button id="newGameBtn">Start Game</button>
</div>

<div id="game" style="display:none;">
  <div class="deck">
    <h3>Main Deck</h3>
    <button id="drawMainBtn">Draw from Main Deck</button>
    <div id="deckCount"></div>
  </div>

  <div class="playarea">
    <h3>Program Area</h3>
    <div id="requirementsDisplay" class="requirements"></div>
    <div id="programArea"></div>
    <div id="functionPoints"></div>
    <button id="completeProgramBtn">Complete Program</button>
    <button id="passBtn">Pass Turn</button>
    <button id="drawLangBtn">Draw from Language Deck</button>
  </div>

  <div id="players"></div>

  <div class="cardinfo">
    <h3>Card Info</h3>
    <div id="cardInfoText">Hover or click a card to see details.</div>
  </div>

  <div class="console">
    <h3>Console Log</h3>
    <div id="consoleLog"></div>
  </div>
</div>

<div class="ruleset">
  <h3>Ruleset</h3>
  <p>
    - Draw one card from Main or Language Deck per turn.<br>
    - Play one card of each type per turn.<br>
    - Variables can be assigned to Functions only if required.<br>
    - Complete programs with at least one Function.<br>
    - First to complete 1 program (Quick) or 3 programs (Full) wins.<br>
    - Hand limit: 8 cards.<br>
  </p>
</div>

<script>
// --- Game Variables ---
let NUM_PLAYERS = 3;
let PROGRAMS_TO_WIN = 3;
const MAX_HAND = 8;
let currentPlayer = 0;
let mainDeck = [];
let players = [];
let selectedFunctionIndex = null;

// --- Utility Logger ---
function logAction(msg){
  const log=document.getElementById('consoleLog');
  const entry=document.createElement('div');
  entry.textContent=`> ${msg}`;
  log.appendChild(entry);
  log.scrollTop=log.scrollHeight;
}

// --- Card Creation ---
function createCard(type,name,value=0,desc="",requirements=[]) { return {type,name,value,desc,requirements,variables:[]}; }
const allCards = [];

// --- Example Variables and Functions ---
for(let i=1;i<=12;i++) allCards.push(createCard('Variable',`Integer ${i}`,i,`Integer variable ${i}`));
for(let i=1;i<=6;i++) allCards.push(createCard('Variable',`Boolean ${i}`,1,'Boolean variable'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`String ${i}`,i*2,'String variable'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`Char[] ${i}`,i*2,'Char array'));
for(let i=1;i<=9;i++) allCards.push(createCard('Variable',`Media ${i}`,i*2,'Audio/Video/Image'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`Class ${i}`,i*2,'Class variable'));
for(let i=1;i<=8;i++) allCards.push(createCard('Variable',`Button/Key ${i}`,4,'Input variable'));

// Functions with simplified requirements example
allCards.push(createCard('Function','Assign',0,'Assign one variable',['Variable x1']));
allCards.push(createCard('Function','Add',0,'Add two integers',['Integer x2']));
allCards.push(createCard('Function','CoinFlip',0,'Requires 1 Boolean',['Boolean x1']));

// --- Shuffle ---
function shuffle(deck){ for(let i=deck.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }}

// --- Rendering ---
function renderPlayers(){
  const container=document.getElementById('players');
  container.innerHTML='';
  players.forEach((p,idx)=>{
    const div=document.createElement('div');
    div.className='player-area';
    div.innerHTML=`<h3>${p.name} ${idx===currentPlayer?'(Current)':''}</h3>
      <strong>Score:</strong> ${p.score}<br>
      <strong>Hand:</strong><div id="hand-${idx}"></div>
      <strong>Language Deck:</strong> <div id="langDeckCount-${idx}">${p.langDeck.length} cards</div>`;
    container.appendChild(div);
    renderHand(idx);
  });
}

function renderHand(idx){
  const handDiv=document.getElementById(`hand-${idx}`);
  handDiv.innerHTML='';
  players[idx].hand.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}`;
    cDiv.textContent=c.name;
    cDiv.onmouseover=()=>showCardInfo(c);
    if(idx===currentPlayer) cDiv.onclick=()=>playCard(i);
    handDiv.appendChild(cDiv);
  });
}

function renderDeck(){ document.getElementById('deckCount').textContent=`Cards left: ${mainDeck.length}`; }

function renderProgram(){
  const div=document.getElementById('programArea'); 
  div.innerHTML='';
  const reqDiv=document.getElementById('requirementsDisplay');
  reqDiv.innerHTML='';
  const pointsDiv=document.getElementById('functionPoints');
  pointsDiv.innerHTML='';
  
  const func = players[currentPlayer].program[selectedFunctionIndex];
  if(func){
    // Requirements display
    func.requirements.forEach(r=>{
      const cardDiv=document.createElement('div');
      cardDiv.className='requirement-card '+ (func.variables.length>=parseInt(r.match(/\dx/)?r[1]:1)?'requirement-met':'requirement-not');
      cardDiv.textContent=(func.variables.length>=parseInt(r.match(/\dx/)?r[1]:1)?'✓ ':'✗ ')+r;
      reqDiv.appendChild(cardDiv);
    });
    // Total points
    const totalPoints = func.variables.reduce((s,v)=>s+v.value,0);
    pointsDiv.textContent=`Function Points: ${totalPoints}`;
  }

  players[currentPlayer].program.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}${selectedFunctionIndex===i?' selected':''}`;
    cDiv.textContent=c.name;
    cDiv.onmouseover=()=>showCardInfo(c);

    if(c.type==='Function'){
      cDiv.onclick=()=>{ selectedFunctionIndex=i; renderProgram(); };
    }
    div.appendChild(cDiv);

    if(c.variables){
      c.variables.forEach(v=>{
        const vDiv=document.createElement('div');
        vDiv.className=`card ${v.type}`;
        vDiv.textContent=v.name;
        div.appendChild(vDiv);
      });
    }
  });
}

function showCardInfo(card){ document.getElementById('cardInfoText').textContent=`${card.name} (${card.type}): ${card.desc} Value: ${card.value}`;}

// --- Actions ---
document.getElementById('drawMainBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(mainDeck.length===0) return alert('Main deck empty!');
  const card=mainDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Main Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderDeck();
};

document.getElementById('drawLangBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(p.langDeck.length===0) return alert('Language deck empty!');
  const card=p.langDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Language Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderPlayers();
};

function playCard(idx){
  const p=players[currentPlayer];
  const card=p.hand[idx];

  if(card.type==='Variable' && selectedFunctionIndex!==null){
    const func=p.program[selectedFunctionIndex];
    func.variables.push(card);
    logAction(`${p.name} assigned ${card.name} to ${func.name}`);
    p.hand.splice(idx,1);
    renderHand(currentPlayer);
    renderProgram();
    return;
  }

  logAction(`${p.name} played ${card.type}: ${card.name}`);
  p.hand.splice(idx,1);
  p.program.push(card);
  renderHand(currentPlayer);
  selectedFunctionIndex=p.program.length-1;
  renderProgram();
}

document.getElementById('completeProgramBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(!p.program.some(c=>c.type==='Function')) return alert('Need at least one Function!');
  let score=p.program.reduce((s,c)=>{
    if(c.type==='Variable') return s+c.value;
    if(c.type==='Function') return s+c.variables.reduce((s2,v)=>s2+v.value,0);
    return s;
  },0);
  p.score+=score;
  p.programs.push(score);
  logAction(`${p.name} completed a program worth ${score} points! Total: ${p.score}`);
  p.program=[];
  selectedFunctionIndex=null;
  if(p.programs.length>=PROGRAMS_TO_WIN){ 
    alert(`${p.name} wins the game!`);
    logAction(`${p.name} has won the game!`);
    document.getElementById('game').style.display='none'; 
    return;
  }
  nextPlayer();
};

document.getElementById('passBtn').onclick=()=>{ 
  logAction(`${players[currentPlayer].name} passed their turn.`);
  nextPlayer(); 
};

function nextPlayer(){ 
  currentPlayer=(currentPlayer+1)%players.length; 
  logAction(`It is now ${players[currentPlayer].name}'s turn.`);
  renderPlayers(); 
  renderProgram(); 
}

// --- New Game ---
document.getElementById('newGameBtn').onclick=()=>{
  NUM_PLAYERS=parseInt(document.getElementById('numPlayers').value);
  const size=document.getElementById('gameSize').value;
  PROGRAMS_TO_WIN=size==='quick'?1:3;
  currentPlayer=0;
  players.length=0;
  mainDeck=[];
  for(let i=0;i<NUM_PLAYERS;i++){
    const langDeck=allCards.filter(c=>['Function','Loop','Library'].includes(c.type));
    shuffle(langDeck);
    players.push({name:`Player ${i+1}`, hand:[], programs:[], score:0, program:[], langDeck:langDeck});
  }
  mainDeck=allCards.filter(c=>['Variable','Bonus','Bug','Event','IfElse'].includes(c.type));
  shuffle(mainDeck);
  document.getElementById('consoleLog').innerHTML='';
  logAction(`New game started with ${NUM_PLAYERS} players. First to ${PROGRAMS_TO_WIN} programs wins.`);
  document.getElementById('game').style.display='flex';
  renderPlayers();
  renderDeck();
  renderProgram();
};
</script>
</body>
</html>
