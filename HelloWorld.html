<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hello, World! Full Game</title>
<style>
body { font-family: Arial; padding: 20px; background: #f0f0f0; margin-bottom: 220px; }
#game { display: flex; flex-wrap: wrap; gap: 20px; }
.deck, .player-area, .playarea, .cardinfo, .setup, .console { 
  border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: #fff; min-width: 220px; 
}
.card { margin: 5px; padding: 5px; border-radius: 5px; cursor: pointer; display:inline-block; }
.Function { background: #f88; }
.Variable { background: #88f; }
.Loop { background: #f90; }
.Library { background: #8f8; }
.Bonus { background: #ff8; }
.Bug { background: #333; color: #fff; }
.Event { background: #0ff; }
.IfElse { background: #a0a; color: #fff; }
.selected { border: 2px solid gold; }
.ruleset { position: fixed; bottom: 0; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: #ddd; transition: max-height 0.3s ease; padding: 10px; }
.ruleset h3 { cursor: pointer; }
.ruleset.minimized { max-height: 20px; overflow: hidden; }
.console { max-height: 150px; overflow-y: auto; background: #111; color: #0f0; font-family: monospace; }
</style>
</head>
<body>
<h1>Hello, World! Full Game</h1>

<div class="setup">
<h3>New Game</h3>
Players: <input type="number" id="numPlayers" min="3" value="3"><br>
Game Size: <select id="gameSize">
  <option value="quick">Quick Game</option>
  <option value="full">Full Game</option>
</select><br>
<button id="newGameBtn">Start Game</button>
</div>

<div id="game" style="display:none;">
  <div class="deck">
    <h3>Main Deck</h3>
    <button id="drawMainBtn">Draw from Main Deck</button>
    <div id="deckCount"></div>
  </div>

  <div class="playarea">
    <h3>Program Area</h3>
    <div id="programArea"></div>
    <button id="completeProgramBtn">Complete Program</button>
    <button id="passBtn">Pass Turn</button>
    <button id="drawLangBtn">Draw from Language Deck</button>
  </div>

  <div id="players"></div>

  <div class="cardinfo">
    <h3>Card Info</h3>
    <div id="cardInfoText">Click a Function card to see requirements.</div>
  </div>

  <div class="console">
    <h3>Game Log</h3>
    <div id="consoleLog"></div>
  </div>
</div>

<div class="ruleset" id="rulesetBox">
  <h3 id="toggleRules">Ruleset (click to minimize)</h3>
  <p>
    - Draw one card from Main or Language Deck per turn.<br>
    - Play one card of each type per turn.<br>
    - Functions require specific Variables (see Function Info).<br>
    - Complete programs with at least one Function.<br>
    - Score Variables + Bonuses.<br>
    - First to complete 1 program (Quick) or 3 programs (Full) wins.<br>
    - Hand limit: 8 cards.<br>
  </p>
</div>

<script>
// --- Game Variables ---
let NUM_PLAYERS = 3;
let PROGRAMS_TO_WIN = 3;
const MAX_HAND = 8;
let currentPlayer = 0;
let mainDeck = [];
let players = [];
let selectedFunctionIndex = null;

// --- Function Requirements ---
const funcRequirements = {
  "Assign": {variables:["any"], libraries:[], points:1},
  "Evaluate": {variables:["any","any"], libraries:[], points:2},
  "Add": {variables:["Integer","Integer"], libraries:[], points:3},
  "Subtract": {variables:["Integer","Integer"], libraries:[], points:3},
  "Multiply": {variables:["Integer","Integer"], libraries:[], points:3},
  "Divide": {variables:["Integer","Integer"], libraries:[], points:3},
  "Calculator": {variables:["Integer","Integer"], libraries:["IOstream"], points:5},
  "CoinFlip": {variables:["Boolean"], libraries:[], points:2},
  "Print": {variables:["String"], libraries:[], points:2},
  "Concatenate": {variables:["String"], libraries:[], points:2},
  "Conjoin": {variables:["String","String"], libraries:["IOstream"], points:4}
  // Can expand with Medium/Hard/Extreme later
};

// --- Utility Logger ---
function logAction(msg){
  const log=document.getElementById('consoleLog');
  const entry=document.createElement('div');
  entry.textContent=`> ${msg}`;
  log.appendChild(entry);
  log.scrollTop=log.scrollHeight;
}

// --- Card Creation ---
function createCard(type,name,value=0,desc=""){ return {type,name,value,desc}; }
const allCards = [];

// Variables
for(let i=1;i<=12;i++) allCards.push(createCard('Variable',`Integer ${i}`,i,`Integer variable ${i}`));
for(let i=1;i<=6;i++) allCards.push(createCard('Variable',`Boolean ${i}`,1,'Boolean variable'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`String ${i}`,i*2,'String variable'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`Char[] ${i}`,i*2,'Char array'));
for(let i=1;i<=9;i++) allCards.push(createCard('Variable',`Media ${i}`,i*2,'Audio/Video/Image'));
for(let i=1;i<=5;i++) allCards.push(createCard('Variable',`Class ${i}`,i*2,'Class variable'));
for(let i=1;i<=8;i++) allCards.push(createCard('Variable',`Button/Key ${i}`,4,'Input variable'));

// Functions
Object.keys(funcRequirements).forEach(f=>allCards.push(createCard('Function',f,funcRequirements[f].points,`Function ${f}`)));

// --- Shuffle ---
function shuffle(deck){ for(let i=deck.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }}

// --- Rendering ---
function renderPlayers(){
  const container=document.getElementById('players');
  container.innerHTML='';
  players.forEach((p,idx)=>{
    const div=document.createElement('div');
    div.className='player-area';
    div.innerHTML=`<h3>${p.name} ${idx===currentPlayer?'(Current)':''}</h3>
      <strong>Score:</strong> ${p.score}<br>
      <strong>Hand:</strong><div id="hand-${idx}"></div>
      <strong>Language Deck:</strong> <div id="langDeckCount-${idx}">${p.langDeck.length} cards</div>`;
    container.appendChild(div);
    renderHand(idx);
  });
}

function renderHand(idx){
  const handDiv=document.getElementById(`hand-${idx}`);
  handDiv.innerHTML='';
  players[idx].hand.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}`;
    cDiv.textContent=c.name + (c.type==='Function' ? ` (${c.value} pts)` : '');
    cDiv.onmouseover=()=>showCardInfo(c);
    if(idx===currentPlayer) cDiv.onclick=()=>playCard(i);
    handDiv.appendChild(cDiv);
  });
}

function renderDeck(){ document.getElementById('deckCount').textContent=`Cards left: ${mainDeck.length}`; }

function renderProgram(){
  const div=document.getElementById('programArea'); div.innerHTML='';
  const p=players[currentPlayer];
  p.program.forEach((c,i)=>{
    const cDiv=document.createElement('div');
    cDiv.className=`card ${c.type}${selectedFunctionIndex===i?' selected':''}`;
    cDiv.textContent=c.name + (c.type==='Function'?` (${c.value} pts)`:'');
    cDiv.onmouseover=()=>showCardInfo(c);

    if(c.type==='Function'){
      cDiv.onclick=()=>{ selectedFunctionIndex=i; renderProgram(); };
      if(!c.variables) c.variables=[];
    }
    div.appendChild(cDiv);

    if(c.variables){
      c.variables.forEach(v=>{
        const vDiv=document.createElement('div');
        vDiv.className=`card ${v.type}`;
        vDiv.textContent=v.name;
        div.appendChild(vDiv);
      });
    }
  });
}

function showCardInfo(card){
  const info=document.getElementById('cardInfoText');
  if(card.type==='Function'){
    const req=funcRequirements[card.name];
    if(req){
      info.innerHTML=`<strong>${card.name}</strong> (requires: ${req.variables.join(', ')} ${req.libraries.length?'/ '+req.libraries.join(', '):''}) <br>Points: ${card.value}`;
    } else info.textContent=`${card.name} (${card.type}): ${card.desc} Value: ${card.value}`;
  } else info.textContent=`${card.name} (${card.type}): ${card.desc} Value: ${card.value}`;
}

// --- Actions ---
document.getElementById('drawMainBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(mainDeck.length===0) return alert('Main deck empty!');
  const card=mainDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Main Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderDeck();
};

document.getElementById('drawLangBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(p.hand.length>=MAX_HAND) return alert('Hand full!');
  if(p.langDeck.length===0) return alert('Language deck empty!');
  const card=p.langDeck.pop();
  p.hand.push(card);
  logAction(`${p.name} drew from Language Deck: ${card.name}`);
  renderHand(currentPlayer);
  renderPlayers();
};

function playCard(idx){
  const p=players[currentPlayer];
  const card=p.hand[idx];

  if(card.type==='Variable' && selectedFunctionIndex!==null){
    const func=p.program[selectedFunctionIndex];
    const req=funcRequirements[func.name];
    const needed=func.variables.length<req.variables.length;
    if(!needed) return alert('Function already has required variables.');
    func.variables.push(card);
    logAction(`${p.name} assigned ${card.name} to ${func.name}`);
    p.hand.splice(idx,1);
    renderHand(currentPlayer);
    renderProgram();
    return;
  }

  if(card.type==='Function') card.variables=[];
  logAction(`${p.name} played ${card.type}: ${card.name}`);
  p.hand.splice(idx,1);
  p.program.push(card);
  renderHand(currentPlayer);
  renderProgram();
}

document.getElementById('completeProgramBtn').onclick=()=>{
  const p=players[currentPlayer];
  if(!p.program.some(c=>c.type==='Function')) return alert('Need at least one Function!');
  let score=p.program.reduce((s,c)=>{
    if(c.type==='Variable') return s+c.value;
    if(c.type==='Function') return s+c.variables.reduce((s2,v)=>s2+v.value,0)+c.value;
    if(c.type==='Bonus') return s+(c.value||0);
    return s;
  },0);
  p.score+=score;
  p.programs.push(score);
  logAction(`${p.name} completed a program worth ${score} points! Total: ${p.score}`);
  p.program=[];
  selectedFunctionIndex=null;
  if(p.programs.length>=PROGRAMS_TO_WIN){ 
    alert(`${p.name} wins the game!`);
    logAction(`${p.name} has won the game!`);
    document.getElementById('game').style.display='none'; 
    return;
  }
  nextPlayer();
};

document.getElementById('passBtn').onclick=()=>{ 
  logAction(`${players[currentPlayer].name} passed their turn.`);
  nextPlayer(); 
};

function nextPlayer(){ 
  currentPlayer=(currentPlayer+1)%players.length; 
  logAction(`It is now ${players[currentPlayer].name}'s turn.`);
  renderPlayers(); 
  renderProgram(); 
}

// --- Rules Minimizer ---
document.getElementById('toggleRules').onclick=()=>{
  document.getElementById('rulesetBox').classList.toggle('minimized');
};

// --- New Game ---
document.getElementById('newGameBtn').onclick=()=>{
  NUM_PLAYERS=parseInt(document.getElementById('numPlayers').value);
  const size=document.getElementById('gameSize').value;
  PROGRAMS_TO_WIN=size==='quick'?1:3;
  currentPlayer=0;
  players.length=0;
  mainDeck=[];
  for(let i=0;i<NUM_PLAYERS;i++){
    const langDeck=allCards.filter(c=>['Function','Loop','Library'].includes(c.type));
    shuffle(langDeck);
    const hand=[];
    for(let j=0;j<MAX_HAND;j++) hand.push(langDeck.pop());
    players.push({name:`Player ${i+1}`, hand:hand, programs:[], score:0, program:[], langDeck:langDeck});
  }
  mainDeck=allCards.filter(c=>['Variable','Bonus','Bug','Event','IfElse'].includes(c.type));
  shuffle(mainDeck);
  document.getElementById('consoleLog').innerHTML='';
  logAction(`New game started with ${NUM_PLAYERS} players. First to ${PROGRAMS_TO_WIN} programs wins.`);
  document.getElementById('game').style.display='flex';
  renderPlayers();
  renderDeck();
  renderProgram();
};
</script>
</body>
</html>
